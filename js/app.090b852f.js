(function(t){function e(e){for(var a,c,r=e[0],i=e[1],l=e[2],u=0,h=[];u<r.length;u++)c=r[u],Object.prototype.hasOwnProperty.call(o,c)&&o[c]&&h.push(o[c][0]),o[c]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a]);d&&d(e);while(h.length)h.shift()();return n.push.apply(n,l||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],a=!0,r=1;r<s.length;r++){var i=s[r];0!==o[i]&&(a=!1)}a&&(n.splice(e--,1),t=c(c.s=s[0]))}return t}var a={},o={app:0},n=[];function c(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,c),s.l=!0,s.exports}c.m=t,c.c=a,c.d=function(t,e,s){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(c.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)c.d(s,a,function(e){return t[e]}.bind(null,a));return s},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/<nnchat-vue>/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],i=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var d=i;n.push([1,"chunk-vendors"]),s()})({0:function(t,e){},"034f":function(t,e,s){"use strict";var a=s("85ec"),o=s.n(a);o.a},"043a":function(t,e,s){"use strict";var a=s("764a"),o=s.n(a);o.a},"0a3c":function(t,e,s){},"0f7d":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"message-wrapper row",class:[t.message.received?"start-xs":"end-xs"]},[s("div",{staticClass:"message",class:[t.message.received?"received":"sent"]},[t._v(" "+t._s(t.message.content)+" ")])])},o=[],n={props:["message"]},c=n,r=(s("043a"),s("2877")),i=Object(r["a"])(c,a,o,!1,null,"ca8f651a",null);e["default"]=i.exports},"0fc3":function(t,e,s){"use strict";var a=s("dd5c"),o=s.n(a);o.a},1:function(t,e,s){t.exports=s("56d7")},"107c":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"user-wrapper row middle-xs"},[t.$store.state.selectedChat?s("div",{staticClass:"col-xs"},[t._v(" "+t._s(t.$store.state.contacts[t.$store.state.selectedChat].name)+" ")]):t._e(),t.$store.state.canConnect?t._e():s("div",{staticClass:"col-xs end-xs error"},[t._v(" Connection lost ")])]),s("div",{staticClass:"messages-wrapper"},[t.$store.state.selectedChat?s("messages",{attrs:{chat:t.$store.state.chats[t.$store.state.selectedChat]}}):t._e()],1),s("div",{staticClass:"input-wrapper row middle-xs"},[s("div",{staticClass:"col-xs"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],staticClass:"input-field",attrs:{type:"text"},domProps:{value:t.message},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage(e)},input:function(e){e.target.composing||(t.message=e.target.value)}}})])])])},o=[],n=s("ced0"),c={data(){return{message:""}},methods:{sendMessage(){if(0==this.message.length||null==this.$store.state.selectedChat)return;let t={headers:{Authorization:"Bearer "+this.$store.state.credentials.accessToken}};this.$http.post(this.$store.state.apiURL+"send/",{receiver:this.$store.state.selectedChat,message:this.message},t).then(t=>{console.log("message sent."),console.log(t.body)},t=>{console.log(t)}),this.$store.state.chats[this.$store.state.selectedChat].push({received:!1,content:this.message}),Object(n["b"])("chats",this.$store.state.chats).then(()=>{let t=document.getElementById("messages");t.scrollTop=t.scrollHeight}),this.message=""}}},r=c,i=(s("f3a5"),s("2877")),l=Object(i["a"])(r,a,o,!1,null,"205cc0cc",null);e["default"]=l.exports},2:function(t,e){},"284c":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"messages",attrs:{id:"messages"}},t._l(t.chat,(function(t){return s("message",{attrs:{message:t}})})),1)},o=[],n={props:["chat"]},c=n,r=(s("9325"),s("2877")),i=Object(r["a"])(c,a,o,!1,null,"b8a35836",null);e["default"]=i.exports},3:function(t,e){},4:function(t,e){},5:function(t,e){},"56d7":function(t,e,s){"use strict";s.r(e);var a=s("2b0e"),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},n=[],c=s("ced0"),r={created(){this.getStoredData()},methods:{getStoredData(){Object(c["a"])("chats").then(t=>{void 0===t?(console.log("stored chats not found..."),Object(c["b"])("chats",{}).then(()=>{console.log("empty chats list created.")})):this.$store.state.chats=t}),Object(c["a"])("contacts").then(t=>{void 0===t?(console.log("stored contacts not found..."),Object(c["b"])("contacts",{}).then(()=>{console.log("empty contacts list created.")})):this.$store.state.contacts=t}),Object(c["a"])("credentials").then(t=>{void 0===t?(console.log("stored credentials not found..."),this.generateCredentials()):(this.$store.state.credentials=t,console.log("starting to fetch messages..."),this.$options.interval=setInterval(this.getMessages,1e4))})},generateCredentials(){this.$forge.prime.generateProbablePrime(1024,(t,e)=>{this.$store.state.credentials={id:this.$randomString.generate(150),password:this.$randomString.generate(30),secret:e.toString(),lastReceived:0},console.log("new credentials generated."),this.register()})},register(){let t={username:this.$store.state.credentials.id,password:this.$store.state.credentials.password};this.$http.post(this.$store.state.apiURL+"auth/register/",t).then(t=>{t.body.hasOwnProperty("success")&&0==t.body.success?(console.log("user already exists, generating new credentials..."),this.generateCredentials()):t.body.refresh&&t.body.access?(this.$store.state.credentials.refreshToken=t.body.refresh,this.$store.state.credentials.accessToken=t.body.access,Object(c["b"])("credentials",this.$store.state.credentials).then(()=>{console.log("new credentials stored."),console.log("starting to fetch messages..."),this.$options.interval=setInterval(this.getMessages,1e4)})):(console.log("tokens not received: "),console.log(t))},t=>{console.log("error:"),console.log(t)})},getMessages(){let t={headers:{Authorization:"Bearer "+this.$store.state.credentials.accessToken}};this.$http.post(this.$store.state.apiURL+"receive/",{last_message_id:this.$store.state.credentials.lastReceived},t).then(t=>{if(this.$store.state.canConnect=!0,1==t.body.success&&0!=t.body.messages.length)for(let e of t.body.messages)this.$store.state.chats.hasOwnProperty(e.sender)&&(this.$store.state.chats[e.sender].push({received:!0,content:e.message}),this.$store.state.credentials.lastReceived=e.id);Object(c["b"])("chats",this.$store.state.chats),Object(c["b"])("credentials",this.$store.state.credentials)},t=>{console.log("error getting messages:"),"token_not_valid"==t.body.code?(console.log("Token expired."),this.$store.dispatch("refreshToken")):0==t.ok?(console.log("can't connect"),this.$store.state.canConnect=!1):console.log(t)})}}},i=r,l=(s("034f"),s("2877")),d=Object(l["a"])(i,o,n,!1,null,null,null),u=d.exports,h=s("8c4f"),p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-2 col-xs-3"},[s("chats")],1),s("div",{staticClass:"col-md-8 col-xs-9 borders"},[s("conversation")],1),s("div",{staticClass:"col-md-2 col-xs-12 add-contact"},[t.$store.state.addContactVisible?s("add-contact"):t._e()],1)])])},g=[],f={},v=f,m=(s("b84c"),Object(l["a"])(v,p,g,!1,null,"77dfacba",null)),b=m.exports;a["a"].use(h["a"]);const $=[{path:"/",name:"frontpage",component:b}],y=new h["a"]({mode:"history",base:"/<nnchat-vue>/",routes:$});var C=y,_=s("2f62");a["a"].use(_["a"]);var w=new _["a"].Store({state:{addContactVisible:!1,selectedChat:null,contacts:{},chats:{},credentials:{},apiURL:"https://glacial-chamber-87753.herokuapp.com/api/",publicMod:"112457129983317064494133258034491756790943511028023366901014968560410379195027",canConnect:!0},actions:{refreshToken(){let t={headers:{"Content-Type":"application/json"}};this._vm.$http.post(this.state.apiURL+"refresh/",{refresh:this.state.credentials.refreshToken},t).then(t=>{let e=t.body.access;null!=e?(console.log("new access token fetched..."),this.state.credentials.accessToken=e,Object(c["b"])("credentials",this.state.credentials).then(()=>{console.log("token saved.")})):(console.log("couldn't refresh token:"),console.log(t))}).catch(t=>{console.log("error while refreshing token:"),"token_not_valid"==t.body.code&&(console.log("refresh token expired."),this.dispatch("login"))})},login(){let t={username:this.state.credentials.id,password:this.state.credentials.password};this._vm.$http.post(this.state.apiURL+"token/",t).then(t=>{t.body.refresh&&t.body.access?(this.state.credentials.refreshToken=t.body.refresh,this.state.credentials.accessToken=t.body.access,Object(c["b"])("credentials",this.state.credentials).then(()=>{console.log("new tokens stored.")})):(console.log("tokens not received: "),console.log(t))},t=>{console.log("error while logging in:"),console.log(t)})}}}),x=s("28dd"),k=(s("05cc"),s("660e")),O=s("6112"),j=s.n(O),S=s("9a3e"),P=s("7409"),M=s.n(P),R=s("4487"),T=s.n(R),N=s("5c1a"),E=s.n(N);a["a"].use(j.a),a["a"].use(S["default"]),a["a"].use(x["a"]),a["a"].use(k["a"],{breakpoints:{sm:768,lg:1/0}}),Object.defineProperty(a["a"].prototype,"$bigInt",{value:M.a}),Object.defineProperty(a["a"].prototype,"$randomString",{value:T.a}),Object.defineProperty(a["a"].prototype,"$forge",{value:E.a}),a["a"].filter("date",(function(t){if(!t)return"";let e=["January","February","March","April","May","June","July","August","September","October","November","December"],s=t.toString().split(" ")[0].replace(/-/g,"/"),a=new Date(s);return e[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear()})),a["a"].config.productionTip=!1;const D=s("6ae9");D.keys().forEach(t=>{a["a"].component(t.split("/").pop().split(".")[0],D(t).default||D(t))}),new a["a"]({router:C,store:w,render:function(t){return t(u)}}).$mount("#app")},6:function(t,e){},"6ae9":function(t,e,s){var a={"./AddContact.vue":"8fd0","./Chat.vue":"e6b0","./Chats.vue":"ac11","./Conversation.vue":"107c","./Message.vue":"0f7d","./Messages.vue":"284c"};function o(t){var e=n(t);return s(e)}function n(t){if(!s.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}o.keys=function(){return Object.keys(a)},o.resolve=n,t.exports=o,o.id="6ae9"},"764a":function(t,e,s){},"7f57":function(t,e,s){"use strict";var a=s("d0a1"),o=s.n(a);o.a},"85ec":function(t,e,s){},"8fd0":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"add-contact"},[s("div",{staticClass:"close row middle-xs",on:{click:t.hideWindow}},[s("div",{staticClass:"col-xs start-xs"},[t._v(" Close ")]),s("div",{staticClass:"col-xs end-xs"},[t._v(" X ")])]),s("div",{staticStyle:{margin:"10px"}},[t._v(" Contact Name ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.contactName,expression:"contactName"}],staticStyle:{margin:"10px"},attrs:{type:"text"},domProps:{value:t.contactName},on:{input:function(e){e.target.composing||(t.contactName=e.target.value)}}}),s("div",{staticStyle:{margin:"10px"}},[t._v(" Their code ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.contactCode,expression:"contactCode"}],staticStyle:{margin:"10px"},attrs:{type:"text"},domProps:{value:t.contactCode},on:{input:function(e){e.target.composing||(t.contactCode=e.target.value)}}}),s("div",{staticStyle:{margin:"10px"}},[s("button",{on:{click:t.addContact}},[t._v("Add Contact")]),s("br"),s("br"),s("button",{on:{click:function(e){t.addQR=!t.addQR}}},[t._v("Add with QR")]),1==t.addQR?s("div",{attrs:{id:"qr-window"}},[s("qrcode-stream",{on:{decode:t.onQRDecode}})],1):t._e()]),s("div",{staticStyle:{margin:"10px"}},[t._v(" Your QR code ")]),s("qriously",{attrs:{value:t.personalCode,size:177}})],1)},o=[],n=s("ced0"),c={data(){return{addQR:!1,contactName:"",contactCode:"",personalCode:this.$store.state.credentials.id+"_"+this.generatePublic()}},methods:{hideWindow(){this.$store.state.addContactVisible=!1},addContact(){if(0==this.contactName.length)return;if(!this.contactCode.includes("_"))return;let t=this.contactCode.split("_")[0],e=this.generateShared(this.contactCode.split("_")[1]),s={name:this.contactName,key:e};this.$set(this.$store.state.contacts,t,s),this.$set(this.$store.state.chats,t,[]),Object(n["b"])("contacts",this.$store.state.contacts).then(()=>{console.log("contact created..."),Object(n["b"])("chats",this.$store.state.chats).then(()=>{console.log("chat created.")})}),this.hideWindow()},generatePublic(){return this.dh("3",this.$store.state.credentials.secret,this.$store.state.publicMod)},generateShared(t){return this.dh(t,this.$store.state.credentials.secret,this.$store.state.publicMod)},dh(t,e,s){let a=this.$bigInt(t),o=this.$bigInt(e),n=this.$bigInt(s);return a.modPow(o,n).toString()},onQRDecode(t){console.log(`QR code reads: ${t}`),this.contactCode=t}}},r=c,i=(s("0fc3"),s("2877")),l=Object(i["a"])(r,a,o,!1,null,"1421777c",null);e["default"]=l.exports},"90db":function(t,e,s){},9325:function(t,e,s){"use strict";var a=s("b1a7"),o=s.n(a);o.a},9587:function(t,e,s){"use strict";var a=s("c391"),o=s.n(a);o.a},ac11:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chats"},[s("div",{staticClass:"add-contact row middle-xs",on:{click:t.showWindow}},[s("div",{staticClass:"col-xs start-xs"},[t._v(" Add Contact ")]),s("div",{staticClass:"col-xs end-xs"},[t._v(" + ")])]),s("div",{staticClass:"chat-items"},t._l(t.$store.state.contacts,(function(t,e){return s("chat",{attrs:{contact:e}})})),1)])},o=[],n={data(){return{}},methods:{showWindow(){this.$store.state.addContactVisible=!0}}},c=n,r=(s("7f57"),s("2877")),i=Object(r["a"])(c,a,o,!1,null,"24668957",null);e["default"]=i.exports},b1a7:function(t,e,s){},b84c:function(t,e,s){"use strict";var a=s("0a3c"),o=s.n(a);o.a},c391:function(t,e,s){},d0a1:function(t,e,s){},dd5c:function(t,e,s){},e6b0:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat-item row middle-xs",on:{click:t.selectChat}},[s("div",{staticClass:"user col-xs-12"},[t._v(" "+t._s(t.$store.state.contacts[t.contact].name)+" ")]),s("div",{staticClass:"last-message col-xs-12"},[t._v(" id="+t._s(t.contact)+" key="+t._s(t.$store.state.contacts[t.contact].key)+" ")])])},o=[],n={props:["contact"],methods:{selectChat(){this.$store.state.selectedChat=this.contact}}},c=n,r=(s("9587"),s("2877")),i=Object(r["a"])(c,a,o,!1,null,"41978c72",null);e["default"]=i.exports},f3a5:function(t,e,s){"use strict";var a=s("90db"),o=s.n(a);o.a}});
//# sourceMappingURL=app.090b852f.js.map